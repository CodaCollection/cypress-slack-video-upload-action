<p>
  <a href="https://github.com/trymbill/cypress-slack-video-upload-action/actions"><img alt="typescript-action status" src="https://github.com/actions/typescript-action/workflows/build-test/badge.svg"></a>
</p>

# Upload Cypress videos and screenshots directly to Slack

This Github action enables you to take the screenshots and videos generated by Cypress after a test run and upload them directly to a Slack channel of your choice. All files are contained within a single message thread to minimize noise.

## Inputs

### `token`

**Required** Slack app token. See [Internal app tokens](https://slack.com/intl/en-ru/help/articles/215770388-Create-and-regenerate-API-tokens#internal-app-tokens)

- Create an app
- Add `file:write` and `chat.postMessage` permissions
- Install the app into your workspace
- Invite the bot to whatever channels you want to send the videos and screenshots to `/invite <botname>`
- Grab the bot token from `OAuth & Permissions` page

### `channels`

**Required** Slack channels to upload to

### `branch`

**Required** Repo branch to use for output

## Examples

### Upload results after every push

```yml
on: [push]

jobs:
  test-and-upload-results:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: 'Run tests'
        uses: cypress-io/github-action@v2

      - name: 'Upload screenshots and videos to Slack'
        uses: trymbill/cypress-slack-video-upload-action@v1.0.0
        with:
          token: ${{ secrets.SLACK_TOKEN }}
          channels: 'engineering-ops'
          branch: 'WEB-1234'
```

### Only upload when open PRs fail

```yml
on: [pull_request]

jobs:
  test-and-upload-results-on-fail:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: 'Run tests'
        uses: cypress-io/github-action@v2

      - name: 'Upload screenshots and videos to Slack'
        uses: trymbill/cypress-slack-video-upload-action@v1.0.0
        if: failure()
        with:
          token: ${{ secrets.SLACK_TOKEN }}
          channels: 'engineering-ops'
          branch: 'WEB-1234'
```
